<!DOCTYPE html>
<head>
  <title>Pusher Test</title>
  <script src="https://js.pusher.com/4.1/pusher.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script>

    // Enable pusher logging - don't include this in production
    //Pusher.logToConsole = true;

    var pusher = new Pusher('79e8e05ea522377ba6db', {
      encrypted: true
    });
    var bincount = 0
    var channel = pusher.subscribe('panoptes');
    channel.bind('classification', function(data) {
      bincount = bincount+1
      console.log(data)
      ;
      // This code runs each time a classification eventt comes down
      // the pusher pipe
    });
  </script>
</head>
<body>
  <div id="graph"><!-- Plotly chart will be drawn inside this DIV --></div>
</body>

<script>
  var time = new Date();

  var data = [{
    x:[time],
    y:[bincount],
    type: 'bar',
    line:{color: '#80CAF6'}
  }]

  Plotly.plot('graph', data);

  var interval = setInterval(function(){

    var time = new Date();

    var update = {
      x:[[time]],
      y:[[bincount]]
    }


      var olderTime = time.setMinutes(time.getMinutes() - 1);
      var futureTime = time.setMinutes(time.getMinutes() + 1);

      var minuteView = {
            xaxis: {
              type: 'bar',
              range: [olderTime,futureTime]
            }
          };

      Plotly.relayout('graph', minuteView);

    Plotly.extendTraces('graph', update, [0])
    bincount = 0
    console.log(update);
  }, 2000);
</script>
